import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# setup your file path(e.g. D:/Python/python.csv)
path = raw_input("Please enter your file path(e.g. D:/Python/python.csv): ")


# read data into a dataFrame
data = pd.read_csv(path)
print(data.head(10))

# setup your interal control(e.g.GAPDH) and experiment control group name
interCtrl = raw_input("Please enter your interal interal control name(e.g.GAPDH): ")
expCtrl = raw_input("Please enter your experiment control group name: ") 


# calculate Ct mean values for each replicates

# data2 = data.groupby(['SampleName','DetectorName']).mean()

# instead of using groupby, you can remove duplicates using drop_duplicates
data0 = data.drop_duplicates(['SampleName','DetectorName']) 
data2 = data0.set_index(['SampleName','DetectorName'])


print(data2.head(10))


# Assign your sample name and detector name like this
# sample = ['NT ES','NT MESEN','NT NE2','NT NE4','NT NE6','NT TROPH','RNAi ES','RNAi MESEN','RNAi NE2','RNAi NE4','RNAi NE6','RNAi TROPH'] 

# or using set() to build an unordered collection of unique name of sample. 
# However, set object is not itreatable, so we can convert set to list

sample0 = set(data['SampleName'])
sample = list(sample0)

  
# calculate Delta_Ct value, for better interpration,  I use 'GAPDH' as a internal control as demo.

DelCt=pd.DataFrame()
for i in range(len(sample)):
    deltaCt =data2.loc[sample[i]]- data2.loc[(sample[i],interCtrl)]
    deltaCt['Sample'] = sample[i]
    DelCt = DelCt.append(deltaCt)
       

# reshape your dataFrame,export to a csv file
DelCt.index.name = 'Detector'
DelCt2 = DelCt.reset_index()
DelCt3 = DelCt2.set_index(['Sample','Detector'])

# If you want to rename column names, using this code 
#DelCt3.rename(columns={'Ct': 'DeltaCt', 'CtMean': 'DeltaCtMean'}, inplace=True)
DelCt3.rename(columns={'CtMean': 'DeltaCt'}, inplace=True)

DelCt3.to_csv('Delta_Ct.csv')
print(DelCt3.head(10))

# calculate Delta_Delta_Ct, for demo, I use 'NT ES' as our experiment control group.

DDelCt =pd.DataFrame()
for i in range(len(sample)):
    DDeltaCt = DelCt3.loc[sample[i]]-DelCt3.loc[expCtrl]
    DDeltaCt['Sample'] = sample[i]
    DDelCt = DDelCt.append(DDeltaCt)
    



# reshape your dataFrame,export to a csv file
DDelCt.index.name = 'Detector'
DDelCt2 = DDelCt.reset_index()
DDelCt3 = DDelCt2.set_index(['Sample','Detector'])
DDelCt3.rename(columns={'DeltaCt': 'DDeltaCt'}, inplace=True)

DDelCt3.to_csv('Delta_Delta_Ct.csv')
print(DDelCt3.head(10))

    



